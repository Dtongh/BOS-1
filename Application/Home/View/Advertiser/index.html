<extend name="Public/base"/>
<block name="body">

<div class="subMainBox" goal="t_left">
    <!--面包屑-->
    <div class="ri_header">
        <div class="ri_title_box">
            <span class="clip-text">广告主管理</span>
            <span>合作管理</span>
        </div>
        <div class="ri_work">Advertiser management</div>

        <div class="dataTable_columnCa_b pa">
            <div class="dataTable_columnCn_b"></div>
            <div class="dataTableShow_close_b tc">关闭</div>
        </div>
    </div>

    <div><span class="field_customize">查询自定义</span></div>

    <div class="screenBox">
        <form action="{:U('index')}" id="search_form">
            <div class="t_left">
                <div class="ziduan">
                    <label>广告主:&nbsp;</label><input type="text" name="name" value="{$Think.get.name}"/>
                </div>
                <div class="ziduan">
                    <label>合作类型: </label><bselect class="selectpicker" id="sel_ad_type" options="op_ad_type" selected="_GET['ad_type']" first="请选择"/>
                    <input type="hidden"  class="form-control" id="ad_type" name="ad_type" value="{$Think.get.ad_type}">
                </div>

                <?php if($isHas_check==200){ ?>
                <div class="ziduan">
                    <label>是否检查: </label><bselect class="selectpicker" id="is_check_id" options="op_is_check" selected="_GET['is_check']" first="请选择"/>
                    <input type="hidden"  class="form-control" id="is_check" name="is_check" value="{$Think.get.is_check}">
                </div>
                <?php } ?>

                <div class="ziduan">
                    <label>地区: </label><bselect class="selectpicker" id="sel_province_id" options="op_region" selected="_GET['province_id']" first="请选择"/>
                    <input type="hidden"  class="form-control" id="province_id" name="province_id" value="{$Think.get.province_id}">
                </div>
                <div class="ziduan">
                    <label>添加时间: &nbsp;</label><input name="add_time" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="{$Think.get.add_time}"/>
                </div>
                <div class="ziduan">
                    <label>合作状态: </label><select id="sel_hz_status" class="selectpicker">
                    <option value="">全部</option>
                    <?php foreach ($hz_status as $k => $v) { ?>
                    <option value="{$k}" <?php  if($k==$map["hz_status"]){echo "selected='selected'";}?> >{$v}</option>
                    <?php } ?>
                </select>
                    <input type="hidden"  class="form-control" id="hz_status" name="hz_status" value="{$Think.get.hz_status}">
                </div>

                <div class="ziduan">
                    <label>实力评级: </label>
                    <bselect class="selectpicker" id="sel_ad_grade" options="op_ad_grade" selected="_GET['ad_grade']" first="请选择"/>
                    <input type="hidden"  class="form-control" id="ad_grade" name="ad_grade" value="{$Think.get.ad_grade}">
                </div>

                <div class="ziduan">
                    <label>信用评级: </label>
                    <bselect class="selectpicker" id="sel_ad_credit" options="op_ad_grade" selected="_GET['ad_credit']" first="请选择"/>
                    <input type="hidden"  class="form-control" id="ad_credit" name="ad_credit" value="{$Think.get.ad_credit}">
                </div>

            </div>

            <div class="t_right"><input type="submit" value="查 询" /></div>
        </form>
    </div>
    <!--筛选-->
    <!--<div class="screenBox swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <form action="{:U('index')}" id="search_form">
                    &lt;!&ndash;基础查询&ndash;&gt;
                    <span class="screenClick a">点击高级查询</span>
                    <h2>基础查询</h2>
                    <div class="swiperRight">
                            <table class="tableBox">

                                <tr>
                                    <th>广告主名称：</th>
                                    <td><input type="text" name="name" value="{$Think.get.name}"/></td>
                                    <th>合作类型</th>
                                    <td>
                                        <bselect class="selectpicker" id="sel_ad_type" options="op_ad_type" selected="_GET['ad_type']" first="请选择"/>
                                        <input type="hidden"  class="form-control" id="ad_type" name="ad_type">
                                    </td>
                                    <?php if($isHas_check==200){ ?>
                                    <th>是否检查：</th>
                                    <td><bselect class="selectpicker" name="is_check" options="op_is_check" selected="_GET['is_check']" first="请选择"/></td>
                                    <?php } ?>
                                    <th>&nbsp;</th>
                                    <td >
                                        <input type="submit" value="查询" />
                                    </td>
                                </tr>
                                <tr>

                                </tr>
                            </table>
                    </div>

                &lt;!&ndash;end 基础查询&ndash;&gt;
            </div>
            <div class="swiper-slide">
                    &lt;!&ndash;高级查询&ndash;&gt;
                <span class="screenClick b">点击基础查询</span>
                    <h2>高级查询</h2>
                    &lt;!&ndash;<div class="swiperLeft">
                        <p class="swiperTit" style="height: 10px;"><img src="__new_boss__/images/screen_gj.png" alt=""></p>
                        <div class="searchBox">
                            <input class="searchTxt" name="name" value="{$Think.get.name}" type="text" placeholder="广告主名称">
                            <p class="closeSearch"></p>
                        </div>
                    </div>&ndash;&gt;
                    <div class="swiperRight">
                            <table class="tableBox">
                            <tr>
                                <th>地区</th>
                                <td><bselect class="selectpicker" name="sel_province_id" options="op_region" selected="_GET['province_id']" first="请选择"/>
                                    <input type="hidden"  class="form-control" id="province_id" name="province_id">
                                </td>
                                <th>添加时间</th>
                                <td><input name="add_time" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="{$Think.get.add_time}"/></td>
                                <th>合作状态</th>
                                <td>
                                    <select id="sel_hz_status" class="selectpicker">
                                        <option value="">全部</option>
                                        <?php foreach ($hz_status as $k => $v) { ?>
                                        <option value="{$k}" <?php  if($k==$map["hz_status"]){echo "selected='selected'";}?> >{$v}</option>
                                        <?php } ?>
                                    </select>
                                    <input type="hidden"  class="form-control" id="hz_status" name="hz_status">
                                </td>
                                <th>&nbsp;</th>
                                <td >
                                    <input type="submit" class="test" value="查询" />
                                </td>
                            </tr>
                            <tr>
                                <th>实力评级</th>
                                <td><bselect class="selectpicker" name="sel_ad_grade" options="op_ad_grade" selected="_GET['ad_grade']" first="请选择"/>
                                    <input type="hidden"  class="form-control" id="ad_grade" name="ad_grade">
                                </td>
                                <th>信用评级</th>
                                <td><bselect class="selectpicker" id="sel_ad_credit" options="op_ad_grade" selected="_GET['ad_credit']" first="请选择"/>
                                    <input type="hidden"  class="form-control" id="ad_credit" name="ad_credit">
                                </td>

                            </tr>
                        </table>
                    </div>
                </form>
                &lt;!&ndash;end 高级查询&ndash;&gt;
            </div>
        </div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
    </div>-->

    <!--<div class="screenList fl w">
        <form action="{:U('index')}" id="search_form">
        <table>
            <tr>
                <th>广告主名称：</th>
                <td><input type="text" name="name" value="{$Think.get.name}"/></td>
                <th>类型：</th>
                <td><bselect name="ad_type" options="op_ad_type" selected="_GET['ad_type']" first="请选择"/></td>
                <th>地区：</th>
                <td><bselect name="province_id" options="op_region" selected="_GET['province_id']" first="请选择"/></td>
                <th>添加时间：</th>
                <td>
                    <input name="add_time" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="{$Think.get.add_time}"/>
                </td>
            </tr>
            <tr>
                <?php if($isHas_check==200){ ?>
                    <th>是否检查：</th>
                    <td><bselect name="is_check" options="op_is_check" selected="_GET['is_check']" first="请选择"/></td>
                <?php } ?>


                <th>实力评级</th>
                <td><bselect name="ad_grade" options="op_ad_grade" selected="_GET['ad_grade']" first="请选择"/></td>
                <th>信用评级</th>
                <td><bselect name="ad_credit" options="op_ad_grade" selected="_GET['ad_credit']" first="请选择"/></td>
                <th>合作状态</th>
                <td>
                    <select name="hz_status" >
                        <option value="">全部</option>
                        <?php foreach ($hz_status as $k => $v) { ?>
                            <option value="{$k}" <?php  if($k==$map["hz_status"]){echo "selected='selected'";}?> >{$v}</option>
                        <?php } ?>
                    </select>
                </td>
                <th></th>
                <td></td>
            </tr>
            <tr>
                <td colspan="8">
                    <input type="submit" value="查询" />
                </td>
            </tr>
        </table>
            <input type="hidden" name="p" value="1"/>
        </form>
    </div>-->

    <!--数据表-->
    <div class="dataCn fl w ha" id="table_con">
        <!--列表头部功能-->
        <div class="advancedTit"  goal="dataTable1">

            <div class="dataTable_columnCa pa">
                <div class="dataTable_columnCn"></div>
                <div class="dataTableShow_close tc">关闭</div>
            </div>

            <div class="advancedLeft tt">
                <span class="addAdv advBtn"><a href="{:U('edit')}">新增</a></span><span class="export advBtn" id="doExport">导出</span>
            </div>

            <div class="advancedRight">
                <div class="advIcon statisticsThumbnail_icon J_statisticsThumbnail fr">可视化报表</div>
                <div class="dataTableShow fr" goal="dataTable1">
                    <div class="advIcon dataTableShow_icon fr del">字段筛选</div>
                </div>
            </div>

        </div>

        <table class="dataTable dataTable1">
            <thead>
            <tr>
                <th>序号</th>
                <th>广告主名称</th>
                <th>地区</th>
                <th>对接人</th>
                <th>属性</th>
                <th>类型</th>
                <th>行业类型/涉及行业</th>
                <th>合作评级</th>
                <th>信用评级</th>
                <?php if($isHas_check==200){ ?>
                <th>是否检查</th>
                <?php } ?>
                <th>合作状态</th>
                <th width="150">操作</th>
            </tr>
            </thead>
            <tbody>
            <notempty name="list">
                   <volist name="list" id="item">
                        <tr>
                            <td>{$item.id}</td>
                            <td>{$item.name}</td>
                            <td>{$item.province_id}</td>
                            <td>{$item.contacts}</td>
                            <td>{$item.ad_type}</td>
                            <td>{$item.tag}</td>
                            <td>{$item.tag2}</td>
                            <td>{$item.ad_grade}</td>
                            <td>{$item.ad_credit}</td>
                            <?php if($isHas_check==200){ ?>
                            <td><if condition="$item.is_check eq 1">是<else/>否</if></td>
                            <?php } ?>
                            <td>{$item["hz_status"]}</td>
                            <td data-status="{$item['status']}">
                                <a href="{:U('edit?id='.$item['id'])}">修改</a><!--class="operateIcon editIco"-->
                                <a href="{:U('detail?id='.$item['id'])}">明细</a><!--class="operateIcon enableIco"-->
                                <a class="doBan" item-id="{$item.id}"><if condition="$item['status'] gt 0">禁用<else/>启用</if></a>
                                <!--class="operateIcon moreIco"-->
                            </td>
                        </tr>
                    </volist>
                <else />
                <tr>
                    <td <?php if($isHas_check==200){ ?> colspan="9" <?php }else{ ?>colspan="10" <?php } ?>>
                        <div class="no-datas">暂无数据！！</div>
                    </td>
                </tr>
            </notempty>
            </tbody>
        </table>
        <!--分页-->
        {$_page}
    </div>
</div>
    <!--统计缩略图-->
<div class="statisticsThumbnail" style="display: none;">
    <img src="__IMG__/statisticsThumbnail_close.png" class="statisticsThumbnail_close" />

    <div id="myChart1" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>
    <div id="myChart2" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>
    <div id="myChart3" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>

    <div id="myChart4" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>
    <div id="myChart5" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>
    <div id="myChart6" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>
</div>


</block>
<block name="script">
    <script src="__MODULE__/ECharts/echarts-all.js" type="text/javascript"></script>
    <script>
        jQuery(function($) {
            //=============================统计图=============================

            //列表字段初始化
            /*if(getCookie('boss30_on_'+getHref()+'_dataTable1_state')!='activate' || getCookie('boss30_on_'+getHref()+'_dataTable1_state')=='' || getCookie('boss30_on_'+getHref()+'_dataTable1_state')==null || getCookie('boss30_on_'+getHref()+'_dataTable1_state')==undefined) {
                setCookie('boss30_on_'+getHref()+'_dataTable1','1100011001',30);
            }

            //查询字段初始化 2017.10.27
            if(getCookie('boss30_on_'+getHref()+'_t_left_state')!='activate' || getCookie('boss30_on_'+getHref()+'_t_left_state')=='' || getCookie('boss30_on_'+getHref()+'_t_left_state')==null || getCookie('boss30_on_'+getHref()+'_t_left_state')===undefined) {
                setCookie('boss30_on_'+getHref()+'_t_left','1111000',30);
            }*/

            // 基于准备好的dom，初始化echarts图表(初始化不加载，点击按钮后再查询加载图表，否则初始化慢) start
            $(".fr").click(function(){

                var myChart1 = echarts.init(document.getElementById('myChart1'));
                var myChart2 = echarts.init(document.getElementById('myChart2'));
                var myChart3 = echarts.init(document.getElementById('myChart3'));
                var myChart4 = echarts.init(document.getElementById('myChart4'));
                var myChart5 = echarts.init(document.getElementById('myChart5'));
                var myChart6 = echarts.init(document.getElementById('myChart6'));

                //饼图
                var pie = {
                    backgroundColor: 'rgba(255,255,255,0.9)',
                    title : {
                        text: '',
                        x: 'center',
                        textStyle: {
                            fontSize: 16,
                            color: '#1a72d6'
                        },
                        padding: 15,
                    },
                    tooltip : {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    /*legend: {
                        orient: 'vertical',
                        left: 'right',
                        data: []
                    },*/
                    calculable : true,
                    series : [
                        {
                            name:'',
                            type:'pie',
                            radius : '55%',
                            center: ['50%', '60%'],
                            data:[],
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };


                //柱状图
                var histogram = {
                    backgroundColor: 'rgba(255,255,255,0.9)',
                    title : {
                        text: '区域分布',
                        x: 'center',
                        textStyle: {
                            fontSize: 16,
                            color: '#1a72d6'
                        },
                        padding: 15,
                    },
                    tooltip : {
                        trigger: 'axis'
                    },
                    calculable : true,
                    xAxis : [
                        {
                            type : 'category',
                            data : []

                        }
                    ],
                    yAxis : [
                        {
                            type : 'value'
                        }
                    ],
                    series : [
                        {
                            name:'地区',
                            type:'bar',
                            data: []
                        }
                    ]
                };


                var charts = [1,2,3,4,5,6];
                for(var i in charts) {
                    var item = charts[i];
                    $.get("{:U('chartView')}",{item:item},function(ret){
                        var idx = ret.item;
                        var data = ret.data;
                        var fields = ret.fields;
                        switch (idx) {
                            case 1:
                                pie.title.text = '广告主等级占比';
                                //pie.legend.data = fields;
                                pie.series[0].name = '等级';
                                pie.series[0].data = data;
                                // 为echarts对象加载数据
                                myChart1.setOption(pie);
                                break;
                            case 2:
                                pie.title.text = '大客户占比';
                                //pie.legend.data = fields;
                                pie.series[0].name = '状态';
                                pie.series[0].data = data;
                                // 为echarts对象加载数据
                                myChart2.setOption(pie);
                                break;
                            case 3:
                                pie.title.text = '广告主行业分布';
                                //pie.legend.data = fields;
                                pie.series[0].name = '类型';
                                pie.series[0].data = data;
                                // 为echarts对象加载数据
                                myChart3.setOption(pie);
                                break;
                            case 4:
                                pie.title.text = '客户遗失占比分析';
                                //pie.legend.data = fields;
                                pie.series[0].name = '行业';
                                pie.series[0].data = data;
                                // 为echarts对象加载数据
                                myChart4.setOption(pie);
                                break;
                            case 5:
                                var xdata=[],ydata=[];
                                for(var i in data) {
                                    var item = data[i];
                                    xdata.push(item.name);
                                    ydata.push(item.value);
                                }
                                histogram.xAxis[0].data=  xdata;
                                histogram.series[0].data = ydata;
                                myChart5.setOption(histogram);
                                break;
                            case 6:
                                pie.title.text = '广告主类型占比';
                                //pie.legend.data = fields;
                                pie.series[0].name = '类型';
                                pie.series[0].data = data;
                                // 为echarts对象加载数据
                                myChart6.setOption(pie);
                                break;
                        }

                    });

                }
                //页面跳转
                myChart2.on('click', function (param){
                    window.open("{:U('chartDetailView?itemid=2')}");
                });
                //饼状图等 end

            });

            $("#doExport").click(function(){
                var param = $("#search_form").serialize();
                //var param2 = $("#search_form2").serialize();
                var url = "{:U('export')}";
                window.location.href=url+'?'+param;
            });

            $("#doRating").click(function(){
                var url = "{:U('doRating')}";
                var thisdialog = alertnewpage2('评级中,请稍等...');
                $.get(url, {}, function (ret) {
                    thisdialog.dialog("close");
                    if (ret == 0) {
                        alertnewpage2('供应商已评级');
                    } else {
                        alertnewpage2(ret);
                    }
                });
            });


            $(".doBan").click(function(){
                var id = $(this).attr('item-id');
                var href="{:U('delete')}";
                var thisdom = $(this);
                $.get(href, {id:id}, function (ret) {
                    alertnewpage2(ret.msg);
                    if(ret.status == 1) {
                        thisdom.text('禁用');
                    } else if (ret.status == 0) {
                        thisdom.text('启用');
                    }

                });
            });


            $('#sel_ad_type').on('hidden.bs.select', function (e) { //该方法注册到$(function(){})函数中
                var tmpSelected = $('#sel_ad_type').val();
                if (tmpSelected != null) {
                    $('#ad_type').val(tmpSelected);
                } else {
                    $('#ad_type').val("");
                }
            });

            $('#sel_hz_status').on('hidden.bs.select', function (e) { //该方法注册到$(function(){})函数中
                var tmpSelected = $('#sel_hz_status').val();
                if (tmpSelected != null) {
                    $('#hz_status').val(tmpSelected);
                } else {
                    $('#hz_status').val("");
                }
            });
            $('#sel_province_id').on('hidden.bs.select', function (e) { //该方法注册到$(function(){})函数中
                var tmpSelected = $('#sel_province_id').val();
                if (tmpSelected != null) {
                    $('#province_id').val(tmpSelected);
                } else {
                    $('#province_id').val("");
                }
            });

            $('#is_check_id').on('hidden.bs.select', function (e) { //该方法注册到$(function(){})函数中
                var tmpSelected = $('#is_check_id').val();
                if (tmpSelected != null) {
                    $('#is_check').val(tmpSelected);
                } else {
                    $('#is_check').val("");
                }
            });

            $('#sel_ad_grade').on('hidden.bs.select', function (e) { //该方法注册到$(function(){})函数中
                var tmpSelected = $('#sel_ad_grade').val();
                if (tmpSelected != null) {
                    $('#ad_grade').val(tmpSelected);
                } else {
                    $('#ad_grade').val("");
                }
            });
            $('#sel_ad_credit').on('hidden.bs.select', function (e) { //该方法注册到$(function(){})函数中
                var tmpSelected = $('#sel_ad_credit').val();
                if (tmpSelected != null) {
                    $('#ad_credit').val(tmpSelected);
                } else {
                    $('#ad_credit').val("");
                }
            });

        });
        
    </script>

</block>