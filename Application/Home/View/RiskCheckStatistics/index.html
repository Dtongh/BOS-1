<extend name="Public/base"/>
<block name="body">
<div class="subMainBox">
    <div class="ri_header">
        <div class="ri_title_box">
            <span class="clip-text">产品管理</span>
            <span>合作管理</span>
        </div>
        <div class="ri_work">Product management</div>
    </div>
    <!--筛选-->
    <!--<div class="screenCn fl w ha">
        <div class="screenOperate fl w">
            <input id="doExport" type="button" value="下载报表" class="" />
            <div class="dataTableShow fr" goal="dataTable1">
                <div class="dataTableShow_icon fr"></div>
                <div class="dataTable_columnCa pa">
                    <div class="dataTable_columnCn"></div>
                    <div class="dataTableShow_close tc">关闭</div>
                </div>
            </div>
            <div class="line fr h"></div>
            <div class="statisticsThumbnail_icon J_statisticsThumbnail fr"  ></div>
        </div>
        <div class="screenList fl w">
            <form action="{:U('index')}" id="search_form">
            <table>
                <tr>
                    <th>期间：</th>
                    <td>
                        <input style="width: 43%;" name="sdate" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="<empty name='Think.get.sdate'>{:date('Y-m')}<else/>{$_GET['sdate']}</empty>"/>
                        到
                        <input style="width: 44%;" name="edate" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="{$_GET['edate']}"/>
                    </td>
                    <th>广告主：</th>
                    <td>
                        <div id="multi-sel-ad">&#45;&#45;</div>
                    </td>
                    <th>产品名称：</th>
                    <td>
                        <div id="multi-sel-pro">&#45;&#45;</div>
                    </td>
                    <th>计费标识：</th>
                    <td>
                        <div id="multi-sel-cl">&#45;&#45;</div>
                    </td>
                </tr>
                <tr>
                    <th>销售人员：</th>
                    <td>
                        <div id="multi-sel-saler">&#45;&#45;</div>
                    </td>
                    <th>供应商：</th>
                    <td>
                        <div id="multi-sel-sup">&#45;&#45;</div>
                    </td>
                    <th>商务人员：</th>
                    <td>
                        <div id="multi-sel-busman">&#45;&#45;</div>
                    </td>
                    <th>业务线：</th>
                    <td>
                        <div id="multi-sel-bl">&#45;&#45;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="8">
                        <input id="search_btn" type="submit" value="查询" />
                        <input type="hidden" name="search" value="1"/>
                        <input type="hidden" name="p" value="1"/>
                    </td>
                </tr>
            </table>
            </form>
        </div>
    </div>-->

    <div class="screenBox swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <form action="{:U('index')}" id="search_form">
                    <!--基础查询-->
                    <span class="screenClick a">点击高级查询</span>
                    <h2>基础查询</h2>

                    <div class="swiperRight">
                        <table class="tableBox">
                            <tr>
                                <th>期间：</th>
                                <td style="width: 240px;">
                                    <input style="width: 43%;" name="sdate" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="<empty name='Think.get.sdate'>{:date('Y-m')}<else/>{$_GET['sdate']}</empty>"/>
                                    到
                                    <input style="width: 44%;" name="edate" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="{$_GET['edate']}"/>
                                </td>
                                <th>广告主：</th>
                                <td>
                                    <div id="multi-sel-ad">--</div>
                                </td>
                                <th>产品名称：</th>
                                <td>
                                    <div id="multi-sel-pro">--</div>
                                </td>
                                <td>
                                    <input type="submit" value="查询" />
                                </td>
                            </tr>
                        </table>
                    </div>

                <!--end 基础查询-->
            </div>
            <div class="swiper-slide">

                    <!--高级查询-->
                    <div class="swiperLeft">
                        <p class="swiperTit"><img src="__new_boss__/images/screen_gj.png" alt=""></p>
                        <span class="screenClick b">点击基础查询</span>
                        <h2>高级查询</h2>
                        <!--<div class="searchBox">
                            <input class="searchTxt" name="name" value="{$Think.get.name}" type="text" placeholder="广告主名称">
                            <p class="closeSearch"></p>
                        </div>-->
                    </div>
                    <div class="swiperRight">
                        <table class="tableBox">
                            <tr >
                                <th>计费标识：</th>
                                <td>
                                    <div id="multi-sel-cl">--</div>
                                </td>
                                <th>销售人员：</th>
                                <td>
                                    <div id="multi-sel-saler">--</div>
                                </td>
                                <th>供应商：</th>
                                <td>
                                    <div id="multi-sel-sup">--</div>
                                </td>
                            </tr>
                            <tr>
                                <th>商务人员：</th>
                                <td>
                                    <div id="multi-sel-busman">--</div>
                                </td>
                                <th>业务线：</th>
                                <td>
                                    <div id="multi-sel-bl">--</div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="6">
                                    <input type="submit" value="查询" />
                                </td>
                            </tr>
                        </table>
                    </div>
                </form>
                <!--end 高级查询-->
            </div>
        </div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
    </div>
    <!--数据表-->
    <div class="dataCn fl w ha" id="table_con">
        <div class="advancedTit" goal="dataTable1">

            <div class="dataTable_columnCa pa">
                <div class="dataTable_columnCn"></div>
                <div class="dataTableShow_close tc">关闭</div>
            </div>

            <div class="advancedLeft">
                <span class="export advBtn"><input id="doExport" type="button" value="下载报表" class="" /></span>
            </div>
            <div class="advancedRight">
                <div class="advIcon statisticsThumbnail_icon J_statisticsThumbnail fr">可视化报表</div>
                <div class="dataTableShow fr" goal="dataTable1">
                    <div class="advIcon dataTableShow_icon fr del">字段筛选</div>
                    <!--<div class="dataTable_columnCa pa">
                        <div class="dataTable_columnCn"></div>
                        <div class="dataTableShow_close tc">关闭</div>
                    </div>-->
                </div>
            </div>
        </div>
        <table class="dataTable dataTable1">
            <thead>
            <tr>
                <th <php>echo getorderclass('ym');</php>><a href="<php>echo getorderurl('ym');</php>">年月</a></th>
                <th>广告主</th>
                <th>供应商</th>
                <th>业务线</th>
                <th>产品</th>
                <th>计费标识</th>
                <th>销售</th>
                <th>商务</th>
                <th <php>echo getorderclass('in_money');</php>><a href="<php>echo getorderurl('in_money');</php>">原始收入</a></th>
                <th <php>echo getorderclass('in_newmoney');</php>><a href="<php>echo getorderurl('in_newmoney');</php>">确认收入</a></th>
                <th>收入核减金额</th>
                <th>收入核减率</th>
                <th <php>echo getorderclass('out_money');</php>><a href="<php>echo getorderurl('out_money');</php>">原始成本</a></th>
                <th <php>echo getorderclass('out_newmoney');</php>><a href="<php>echo getorderurl('out_newmoney');</php>">确认成本</a></th>
                <th>成本核减金额</th>
                <th>成本核减率</th>
                <th>利润变动额</th>
                <th>利润变动率</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>汇总</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{$itemTotal['in_money']}</td>
                <td>{$itemTotal['in_newmoney']}</td>
                <td>{$itemTotal['inCheckMoney']}</td>
                <td></td>
                <td>{$itemTotal['out_money']}</td>
                <td>{$itemTotal['out_newmoney']}</td>
                <td>{$itemTotal['outCheckMoney']}</td>
                <td></td>
                <td>{$itemTotal['profitChange']}</td>
                <td></td>
            </tr>
            <volist name="list" id="item">
                <tr>
                    <td>{$item.ym}</td>
                    <td>{$item.adverid}</td>
                    <td>{$item.superid}</td>
                    <td>{$item.lineid}</td>
                    <td>{$item.pro_name}</td>
                    <td>{$item.jf_name}</td>
                    <td>{$item.salerid}</td>
                    <td>{$item.businessid}</td>
                    <td>{$item.in_money}</td>
                    <td>{$item.in_newmoney}</td>
                    <td>{$item.inCheckMoney}</td>
                    <td>{$item.inCheckRatio}</td>
                    <td>{$item.out_money}</td>
                    <td>{$item.out_newmoney}</td>
                    <td>{$item.outCheckMoney}</td>
                    <td>{$item.outCheckRatio}</td>
                    <td>{$item.profitChange}</td>
                    <td>{$item.profitChangeRaio}</td>
                </tr>
            </volist>
            </tbody>
        </table>
        <!--分页-->
        {$_page}
    </div>
</div>

    <!--统计缩略图-->
    <div class="statisticsThumbnail">
        <img src="__IMG__/statisticsThumbnail_close.png" class="statisticsThumbnail_close" />

        <div id="myChart1" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>
        <div id="myChart2" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>
        <div id="myChart3" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>

        <div id="myChart4" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>
        <div id="myChart5" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>
        <div id="myChart6" class="fl" style=" margin: 2%; width: 29%; height: 40%; "></div>
    </div>

</block>
<block name="style">
    <style>
        .ms-ctn{width: 90%; padding: 2px; padding-left: 12px; box-shadow: none; border-color: #c5c5c5;}
        .ms-ctn .ms-trigger .ms-trigger-ico{margin-top: 13px;}
        .ms-sel-ctn input[type="text"]{border: none;}
    </style>
</block>
<block name="script">
    <script src="__MODULE__/ECharts/echarts-all.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function() {
            var adMs = $('#multi-sel-ad').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'ad' },
            });
            var proMs = $('#multi-sel-pro').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'pro' },
            });
            var clMs = $('#multi-sel-cl').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'cl' },
            });

            var salerMs = $('#multi-sel-saler').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'saler' },
            });
            var supMs = $('#multi-sel-sup').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'sup' },
            });
            var busmanMs = $('#multi-sel-busman').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'busman' },
            });
            var blMs = $('#multi-sel-bl').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'bl' },
            });

            //初始化
            clMs.setSelection({$clNames});
            adMs.setSelection({$adNames});
            proMs.setSelection({$proNames});

            salerMs.setSelection({$salerNames});
            supMs.setSelection({$supNames});
            busmanMs.setSelection({$busmanNames});
            blMs.setSelection({$blNames});

            $("#search_btn").click(function() {
                var form = $("#search_form");

                var adval = adMs.getValue();
                var proval = proMs.getValue();
                var clval = clMs.getValue();

                var salerval = salerMs.getValue();
                var supval = supMs.getValue();
                var busmanval = busmanMs.getValue();
                var blval = blMs.getValue();

                var goUrl = form.attr('action')+"?adid="+adval+"&proid="+proval+"&clid="+clval+
                        "&saler="+salerval+"&sup="+supval+"&busman="+busmanval+"&bl="+blval+
                        "&"+form.serialize();
                window.location.href = goUrl;
                return false;
            });


            //=============================统计图=============================
            // 基于准备好的dom，初始化echarts图表
            var myChart1 = echarts.init(document.getElementById('myChart1'));
            var myChart2 = echarts.init(document.getElementById('myChart2'));
            var myChart3 = echarts.init(document.getElementById('myChart3'));
            var myChart4 = echarts.init(document.getElementById('myChart4'));
            var myChart5 = echarts.init(document.getElementById('myChart5'));
            var myChart6 = echarts.init(document.getElementById('myChart6'));

            //饼图
            var pie = {
                backgroundColor: 'rgba(255,255,255,0.9)',
                title : {
                    text: '',
                    x: 'center',
                    textStyle: {
                        fontSize: 16,
                        color: '#1a72d6'
                    },
                    padding: 15,
                },
                tooltip : {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                /*legend: {
                    orient: 'vertical',
                    left: 'right',
                    data: []
                },*/
                calculable : true,
                series : [
                    {
                        name:'',
                        type:'pie',
                        radius : '55%',
                        center: ['50%', '60%'],
                        data:[],
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };

            //柱状图
            var histogram = {
                backgroundColor: 'rgba(255,255,255,0.9)',
                title : {
                    text: '区域分布',
                    x: 'center',
                    textStyle: {
                        fontSize: 16,
                        color: '#1a72d6'
                    },
                    padding: 15,
                },
                tooltip : {
                    trigger: 'axis'
                },
                calculable : true,
                xAxis : [
                    {
                        type : 'category',
                        data : []

                    }
                ],
                yAxis : [
                    {
                        type : 'value'
                    }
                ],
                series : [
                    {
                        name:'金额',
                        type:'bar',
                        data: []
                    }
                ]
            };

            //折线图
            var brokenline = {
                backgroundColor: 'rgba(255,255,255,0.9)',

                title : {
                    text: '',
                    x: 'center',
                    textStyle: {
                        fontSize: 16,
                        color: '#1a72d6'
                    },
                    padding: 15,
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: "{c}%"
                },
                calculable: true,
                xAxis: [{
                    type: 'category',
                    boundaryGap: false,
                    data: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月']
                }],
                yAxis: [{
                    type: 'value'
                }],
                series: [{
                    name: '变动率',
                    type: 'line',
                    stack: '总量',
                    data: ['200.5', 200, 300, 400, 90, 230, 210, 310, 410, 510, 610, 500]
                }]
            };


            var charts = [1,2,3,4,5,6];
            for(var i in charts) {
                var item = charts[i];
                $.get("{:U('chartView')}",{item:item},function(ret){
                    var idx = ret.item;
                    var data = ret.data;
                    var fields = ret.fields;
                    switch (idx) {
                        case 1:
                            pie.title.text = '各业务线核检金额占比';
                            //pie.legend.data = fields;
                            pie.series[0].name = '业务线';
                            pie.series[0].data = data;
                            // 为echarts对象加载数据
                            myChart1.setOption(pie);
                            break;
                        case 2:
                            brokenline.title.text = '全公司核检利润变动率';
                            brokenline.series[0].name = '变动率';
                            var item = [];
                            for(var i in data){
                                item.push(data[i].value);
                            }
                            brokenline.series[0].data = item;
                            // 为echarts对象加载数据
                            myChart2.setOption(brokenline);
                            break;
                        case 3:
                            histogram.title.text = '广告主核检金额top10';
                            var xdata=[],ydata=[];
                            for(var i in data) {
                                var item = data[i];
                                xdata.push(item.name);
                                ydata.push(item.value);
                            }
                            histogram.xAxis[0].data=  xdata;
                            histogram.series[0].data = ydata;
                            myChart3.setOption(histogram);
                            break;
                        case 4:
                            histogram.title.text = '供应商核检金额top10';
                            var xdata=[],ydata=[];
                            for(var i in data) {
                                var item = data[i];
                                xdata.push(item.name);
                                ydata.push(item.value);
                            }
                            histogram.xAxis[0].data=  xdata;
                            histogram.series[0].data = ydata;
                            myChart4.setOption(histogram);
                            break;
                        case 5:
                            histogram.title.text = '销售核检金额';
                            var xdata=[],ydata=[];
                            for(var i in data) {
                                var item = data[i];
                                xdata.push(item.name);
                                ydata.push(item.value);
                            }
                            histogram.xAxis[0].data=  xdata;
                            histogram.series[0].data = ydata;
                            myChart5.setOption(histogram);
                            break;
                        case 6:
                            histogram.title.text = '商务核检金额';
                            var xdata=[],ydata=[];
                            for(var i in data) {
                                var item = data[i];
                                xdata.push(item.name);
                                ydata.push(item.value);
                            }
                            histogram.xAxis[0].data=  xdata;
                            histogram.series[0].data = ydata;
                            myChart6.setOption(histogram);
                            break;
                    }


                });

            }

            $("#doExport").click(function(){
                var param = $("#search_form").serialize();
                var url = "{:U('export')}";
                window.location.href=url+'?'+param;
            });

        });
    </script>
</block>