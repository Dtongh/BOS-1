<extend name="Public/base"/>
<block name="body">
<div class="subMainBox">
    <!--筛选-->
    <!--<div class="screenCn fl w ha">
        <div class="screenOperate fl w">
            <input id="doExport" type="button" value="下载报表" class="" />
            <input type="button" value="高级筛选" class="J_openScreen" />
            <div class="dataTableShow fr" goal="dataTable1">
                <div class="dataTableShow_icon fr"></div>
                <div class="dataTable_columnCa pa">
                    <div class="dataTable_columnCn"></div>
                    <div class="dataTableShow_close tc">关闭</div>
                </div>
            </div>
            <div class="line fr h"></div>
            <div class="statisticsThumbnail_icon J_statisticsThumbnail fr"  ></div>
        </div>
        <div class="screenList fl w">
            <form action="{:U('index')}" id="search_form">
            <table>
                <tr>
                    <th>时间：</th>
                    <td >
                        <input style="width: 94%" name="date" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="{$mon}"/>
                    </td>
                    <th>业务线：</th>
                    <td><div id="multi-sel-bl">&#45;&#45;</div>
                    </td>
                    <th>产品名称：</th>
                    <td>
                        <div id="multi-sel-pro">&#45;&#45;</div>
                    </td>
                    <th>计费标识：</th>
                    <td>
                        <div id="multi-sel-cl">&#45;&#45;</div>
                    </td>
                </tr>
                <tr>
                    <th class="expertScreen">广告主：</th>
                    <td class="expertScreen">
                        <div id="multi-sel-ad">&#45;&#45;</div>
                    </td>
                    <th class="expertScreen">销售人员：</th>
                    <td class="expertScreen">
                        <div id="multi-sel-saler">&#45;&#45;</div>
                    </td>
                    <th class="expertScreen">供应商：</th>
                    <td class="expertScreen">
                        <div id="multi-sel-sup">&#45;&#45;</div>
                    </td>
                    <th class="expertScreen">商务人员：</th>
                    <td class="expertScreen">
                        <div id="multi-sel-busman">&#45;&#45;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="8">
                        <input type="submit" value="查询" />
                        <input type="hidden" name="p" value="1"/>
                        <input type="hidden" name="search" value="1"/>
                    </td>
                </tr>
            </table>
            </form>
        </div>
    </div>-->

    <div class="screenBox swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <form action="{:U('index')}" id="search_form">
                    <!--基础查询-->
                    <span class="screenClick a">点击高级查询</span>
                    <h2>基础查询</h2>

                    <div class="swiperRight">
                        <table class="tableBox">
                            <tr>
                                <th>时间：</th>
                                <td >
                                    <input style="width: 94%" name="date" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="{$mon}"/>
                                </td>
                                <th>业务线：</th>
                                <td><div id="multi-sel-bl">--</div>
                                </td>
                                <th>产品名称：</th>
                                <td>
                                    <div id="multi-sel-pro">--</div>
                                </td>
                                <td>
                                    <input type="submit" value="查询" />
                                </td>
                            </tr>
                        </table>
                    </div>

                <!--end 基础查询-->
            </div>
            <div class="swiper-slide">

                    <!--高级查询-->
                    <div class="swiperLeft">
                        <p class="swiperTit"><img src="__new_boss__/images/screen_gj.png" alt=""></p>
                        <span class="screenClick b">点击基础查询</span>
                        <h2>高级查询</h2>
                        <!--<div class="searchBox">
                            <input class="searchTxt" name="name" value="{$Think.get.name}" type="text" placeholder="广告主名称">
                            <p class="closeSearch"></p>
                        </div>-->
                    </div>
                    <div class="swiperRight">
                        <table class="tableBox">
                            <tr >
                                <th>计费标识：</th>
                                <td>
                                    <div id="multi-sel-cl">--</div>
                                </td>
                                <th>广告主：</th>
                                <td>
                                    <div id="multi-sel-ad">--</div>
                                </td>
                                <th>销售人员：</th>
                                <td>
                                    <div id="multi-sel-saler">--</div>
                                </td>
                            </tr>
                            <tr>
                                <th>供应商：</th>
                                <td>
                                    <div id="multi-sel-sup">--</div>
                                </td>
                                <th>商务人员：</th>
                                <td>
                                    <div id="multi-sel-busman">--</div>
                                </td>
                                <th></th>
                                <td></td>
                            </tr>
                            <tr>
                                <td colspan="6">
                                    <input type="submit" value="查询" />
                                </td>
                            </tr>
                        </table>
                    </div>
                </form>
                <!--end 高级查询-->
            </div>
        </div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
    </div>
    <!--数据表-->
    <div class="dataCn fl w ha" id="table_con">
        <div class="advancedTit" goal="dataTable1">

            <div class="dataTable_columnCa pa">
                <div class="dataTable_columnCn"></div>
                <div class="dataTableShow_close tc">关闭</div>
            </div>

            <div class="advancedLeft">
                <span class="export advBtn"><input id="doExport" type="button" value="下载报表" class="" /></span>
            </div>
            <div class="advancedRight">
                <div class="advIcon statisticsThumbnail_icon J_statisticsThumbnail fr">可视化报表</div>
                <div class="dataTableShow fr" goal="dataTable1">
                    <div class="advIcon dataTableShow_icon fr del">字段筛选</div>
                    <!--<div class="dataTable_columnCa pa">
                        <div class="dataTable_columnCn"></div>
                        <div class="dataTableShow_close tc">关闭</div>
                    </div>-->
                </div>
            </div>
        </div>
        <table class="dataTable dataTable1">
            <thead>
            <tr>
                <th>年月</th>
                <th>业务线</th>
                <th>产品名称</th>
                <th>计费标识</th>
                <th>广告主名称</th>
                <th>供应商名称</th>
                <th>收入审核时间</th>
                <th <php>echo getorderclass('in_money');</php> ><a href="<php>echo getorderurl('in_money');</php>">收入金额</a></th>
                <th>收入状态</th>>
                <th <php>echo getorderclass('out_money');</php> ><a href="<php>echo getorderurl('out_money');</php>">成本支付金额</a></th>

                <th>销售</th>
                <th>商务</th>
            </tr>
            </thead>
            <tbody>
                <tr>
                    <td>汇总</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>{$sumData.in_money|number_format=###,2}</td>
                    <td></td>
                    <td>{$sumData.out_money|number_format=###,2}</td>
                    <td></td>
                    <td></td>
                </tr>
            <volist name="list" id="item">
                <tr>
                    <td>{$item.dates}</td>
                    <td>{$item.bl_name}</td>
                    <td>{$item.pro_name}</td>
                    <td>{$item.cl_name}</td>
                    <td>{$item.ad_name}</td>
                    <td>{$item.sup_name}</td>
                    <td>{$item.in_valid_time}</td>
                    <td>{$item.in_money|number_format=###,2}</td>
                    <td>{$item.status}</td>
                    <td>{$item.out_money|number_format=###,2}</td>
                    <td>{$item.saler_name}</td>
                    <td>{$item.sw_name}</td>
                </tr>
            </volist>
            </tbody>
        </table>
        <!--分页-->
        {$_page}
    </div>
</div>

    <link rel="stylesheet" type="text/css" href="__MODULE__/bootstrapselect/css/bootstrap-select.css"/>
    <!--统计缩略图-->
    <div class="statisticsThumbnail">
        <img src="__IMG__/statisticsThumbnail_close.png" class="statisticsThumbnail_close" />

        <div id="myChart1" class="fl" style=" margin: 2%; width: 46%; height: 92%; "></div>
        <div id="myChart2" class="fl" style=" margin: 2%; width: 46%; height: 92%; "></div>
    </div>
</block>
<block name="style">
    <style>
        .ms-ctn{width: 90%; padding: 2px; padding-left: 12px; box-shadow: none; border-color: #c5c5c5;}
        .ms-ctn .ms-trigger .ms-trigger-ico{margin-top: 13px;}
        .ms-sel-ctn input[type="text"]{border: none;}
    </style>
</block>
<block name="script">
    <script src="__MODULE__/ECharts/echarts-all.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function() {

            $.fn.magicSuggest.defaults = {
                placeholder:''
            };
            var adMs = $('#multi-sel-ad').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'ad' },
            });
            var busmanMs = $('#multi-sel-busman').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'busman' },
            });
            var blMs = $('#multi-sel-bl').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'bl' },

            });
            var proMs = $('#multi-sel-pro').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'pro' },
            });

            var clMs = $('#multi-sel-cl').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'cl' },
            });
            var salerMs = $('#multi-sel-saler').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'saler' },
            });
            var supMs = $('#multi-sel-sup').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'sup' },
            });
            //初始化
            blMs.setSelection({$blNames});
            proMs.setSelection({$proNames});

            salerMs.setSelection({$salerNames});
            supMs.setSelection({$supNames});
            clMs.setSelection({$clNames});
            adMs.setSelection({$adNames});
            busmanMs.setSelection({$busmanNames});
            $("#search_btn").click(function() {
                var form = $("#search_form");

                var blval = blMs.getValue();
                var proval = proMs.getValue();
                var clval = clMs.getValue();
                var salerval = salerMs.getValue();
                var supval = supMs.getValue();

                var busmanval = busmanMs.getValue();
                var adval = adMs.getValue();

                var goUrl = form.attr('action')+"?blid="+blval+"&proid="+proval+
                        "&saler="+salerval+"&sup="+supval+"&clid="+clval+"&adid="+adval+"&busman="+busmanval+
                        "&"+form.serialize();
                window.location.href = goUrl;
                return false;
            });

            //=============================统计图=============================
            // 基于准备好的dom，初始化echarts图表
            var myChart1 = echarts.init(document.getElementById('myChart1'));
            var myChart2 = echarts.init(document.getElementById('myChart2'));

            //饼图
            var pie = {
                backgroundColor: 'rgba(255,255,255,0.9)',
                title : {
                    text: '',
                    x: 'center',
                    textStyle: {
                        fontSize: 16,
                        color: '#1a72d6'
                    },
                    padding: 15,
                },
                tooltip : {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                calculable : true,
                series : [
                    {
                        name:'',
                        type:'pie',
                        radius : '55%',
                        center: ['50%', '60%'],
                        data:[],
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };

            //柱状图
            var histogram = {
                backgroundColor: 'rgba(255,255,255,0.9)',
                title : {
                    text: '',
                    x: 'center',
                    textStyle: {
                        fontSize: 16,
                        color: '#1a72d6'
                    },
                    padding: 15,
                },
                tooltip : {
                    trigger: 'axis'
                },
                calculable : true,
                xAxis : [
                    {
                        type : 'category',
                        data : []

                    }
                ],
                yAxis : [
                    {
                        type : 'value'
                    }
                ],
                series : [
                    {
                        name:'金额',
                        type:'bar',
                        data: []
                    }
                ]
            };

            //页面跳转
            /*myChart1.on('click', function (param){ window.open('index.html') });
             */

            var charts = [1,2];
            for(var i in charts) {
                var item = charts[i];
                $.get("{:U('chartView')}",{item:item},function(ret){
                    var idx = ret.item;
                    var data = ret.data;
                    var fields = ret.fields;
                    switch (idx) {
                        case 1:
                            pie.title.text = '风险等级占比';
                            //pie.legend.data = fields;
                            pie.series[0].name = '等级';
                            pie.series[0].data = data;
                            // 为echarts对象加载数据
                            myChart1.setOption(pie);
                            break;
                        case 2:
                            histogram.title.text = '收支差';
                            var xdata=[],ydata=[];
                            for(var i in data) {
                                var item = data[i];
                                xdata.push(item.name);
                                ydata.push(item.value);
                            }
                            histogram.xAxis[0].data=  xdata;
                            histogram.series[0].data = ydata;
                            myChart2.setOption(histogram);
                            break;
                    }

                });

            }

            $("#doExport").click(function(){
                var param = $("#search_form").serialize();
                var url = "{:U('export')}";
                window.location.href=url+'?'+param;
            });

        });
    </script>
</block>