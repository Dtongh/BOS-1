<extend name="Public/base"/>
<block name="body">
<div class="subMainBox">
    <div class="ri_header">
        <div class="ri_title_box">
            <span class="clip-text">封禁数据</span>
            <span>风控中心</span>
        </div>
        <div class="ri_work">Banned data</div>
    </div>
    <!--筛选-->
    <!--<div class="screenCn fl w ha">
        <div class="screenOperate fl w">
            <input id="doExport" type="button" value="下载报表" class="" />
            <div class="dataTableShow fr" goal="dataTable1">
                <div class="dataTableShow_icon fr"></div>
                <div class="dataTable_columnCa pa">
                    <div class="dataTable_columnCn"></div>
                    <div class="dataTableShow_close tc">关闭</div>
                </div>
            </div>
            <div class="line fr h"></div>
        </div>
        <div class="screenList fl w">
            <form action="{:U('index')}" id="search_form">
                <table>
                    <tr>
                        <th>时间：</th>
                        <td>
                            <input style="width: 94%;" name="date" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="<empty name='Think.get.date'>{:date('Y-m')}<else/>{$_GET['date']}</empty>"/>
                        </td>
                        <th>广告主：</th>
                        <td>
                            <div id="multi-sel-ad">&#45;&#45;</div>
                        </td>
                        <th>产品名称：</th>
                        <td>
                            <div id="multi-sel-pro">&#45;&#45;</div>
                        </td>
                        <th>计费标识：</th>
                        <td>
                            <div id="multi-sel-cl">&#45;&#45;</div>
                        </td>
                    </tr>
                    <tr>
                        <th>业务线</th>
                        <td><div id="multi-sel-bl">&#45;&#45;</div></td>
                        <th>销售人员</th>
                        <td><div id="multi-sel-saler">&#45;&#45;</div></td>
                        <th></th>
                        <td></td>
                        <th></th>
                        <td></td>
                    </tr>
                    <tr>
                        <td colspan="8">
                            <input id="search_btn" type="submit" value="查询" />
                            <input type="hidden" name="p" value="1"/>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>-->

    <div class="screenBox swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <form action="{:U('index')}" id="search_form">

                    <div class="swiperRight">
                        <table class="tableBox">
                            <tr>
                                <th>时间：</th>
                                <td>
                                    <input style="width: 94%;" name="date" readonly="readonly" type="text" onClick="WdatePicker({ dateFmt:'yyyy-MM'})" class="Wdate" value="<empty name='Think.get.date'>{:date('Y-m')}<else/>{$_GET['date']}</empty>"/>
                                </td>
                                <th>广告主：</th>
                                <td>
                                    <div id="multi-sel-ad">--</div>
                                </td>
                                <th>产品名称：</th>
                                <td>
                                    <div id="multi-sel-pro">--</div>
                                </td>
                                <td>
                                    <input id="search_btn" type="submit" value="查询" />
                                    <input type="hidden" name="p" value="1"/>
                                </td>
                            </tr>
                            <tr>
                                <th>计费标识：</th>
                                <td>
                                    <div id="multi-sel-cl">--</div>
                                </td>
                                <th>业务线</th>
                                <td><div id="multi-sel-bl">--</div></td>
                                <th>销售人员</th>
                                <td><div id="multi-sel-saler">--</div></td>

                            </tr>
                        </table>
                    </div>
                </form>
                <!--end 基础查询-->
            </div>
        </div>
    </div>
    <!--数据表-->
    <div class="dataCn fl w ha" id="table_con">
        <div class="advancedTit">
            <div class="advancedLeft">
                <span class="export advBtn"><input id="doExport" type="button" value="下载报表" class="" /></span>
            </div>
        </div>
        <table class="dataTable dataTable1">
            <thead>
            <tr>
                <th>日期</th>
                <th>计费标识ID</th>
                <th>计费标识名称</th>
                <th>单价</th>
                <th>计费模式</th>
                <th>有效数据</th>
                <th>金额</th>
                <th>依据</th>
                <th>产品名称</th>
                <th>广告主名称</th>
                <th>业务线</th>
                <th>所属销售</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>汇总</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{$itemTotal['datanum']}</td>
                <td>{$itemTotal['money']|round=###,2}</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <volist name="list" id="item">
                <tr>
                    <td>{$item.adddate}</td>
                    <td>{$item.jfid}</td>
                    <td>{$item.jfname}</td>
                    <td>{$item.price}</td>
                    <td>{$op_charging_mode[$item['jftype']]}</td>
                    <td>{$item.datanum}</td>
                    <td>{$item.money}</td>
                    <td><a target="_blank" href="http://{$Think.server.HTTP_HOST}{$item['banimgpath']}" class="fileDownload">下载</a></td>
                    <td>{$item.pro_name}</td>
                    <td>{$item.ad_name}</td>
                    <td>{$item.bl_name}</td>
                    <td>{$item.saler_name}</td>
                </tr>
            </volist>

            </tbody>
        </table>
        <!--分页-->
        {$_page}
    </div>
</div>

    <link rel="stylesheet" type="text/css" href="__MODULE__/bootstrapselect/css/bootstrap-select.css"/>
</block>
<block name="style">
    <style>
        .ms-ctn{width: 90%; padding: 2px; padding-left: 12px; box-shadow: none; border-color: #c5c5c5;}
        .ms-ctn .ms-trigger .ms-trigger-ico{margin-top: 13px;}
        .ms-sel-ctn input[type="text"]{border: none;}

    </style>
</block>
<block name="script">
    <script type="text/javascript" src="__MODULE__/bootstrapselect/bootstrap-select.js"></script>
    <script src="__MODULE__/ECharts/echarts-all.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function() {

            var adMs = $('#multi-sel-ad').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'ad' },
            });
            var proMs = $('#multi-sel-pro').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'pro' },
            });
            var clMs = $('#multi-sel-cl').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'cl' },
            });
            var salerMs = $('#multi-sel-saler').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'saler' },
            });
            var blMs = $('#multi-sel-bl').magicSuggest({
                queryParam: 'q',
                data: "{:U('Ajax/mutiQuery')}",
                typeDelay: 5,
                dataUrlParams: { type: 'bl' },
            });
            //初始化
            adMs.setSelection({$adNames});
            proMs.setSelection({$proNames});
            clMs.setSelection({$clNames});

            salerMs.setSelection({$salerNames});
            blMs.setSelection({$blNames});

            $("#search_btn").click(function() {
                var form = $("#search_form");

                var adval = adMs.getValue();
                var proval = proMs.getValue();
                var clval = clMs.getValue();

                var salerval = salerMs.getValue();
                var blval = blMs.getValue();

                var goUrl = form.attr('action')+"?adid="+adval+"&proid="+proval+"&clid="+clval+
                        "&saler="+salerval+"&bl="+blval+
                        "&"+form.serialize();
                window.location.href = goUrl;
                return false;
            });



            $("#doExport").click(function(){
                var param = $("#search_form").serialize();
                var url = "{:U('export')}";
                window.location.href=url+'?'+param;
            });
        });
    </script>
</block>